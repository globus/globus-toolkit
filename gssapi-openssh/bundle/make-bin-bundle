#!/bin/sh
#
# Usage:
#
#   1) Verify that your GLOBUS_LOCATION is set to the installation from which you
#      wish to create a binary bundle.
#
#   2) Run the bin-bundle creation script, passing the platform name to it:
#
#        ./make-bin-bundle <platform>
#

if [ "x$GLOBUS_LOCATION" = "x" ]; then
    echo "Please set GLOBUS_LOCATION to the location from which you wish to make the binary bundle."
    exit;
fi

if [ "x$1" = "x" ]; then
    echo "Usage: make-bin-bundle <platform>"
    echo "Example platforms:"
    echo "  i686-pc-linux-gnu-gcc32"
    echo "  sparc-sun-solaris2.8-vendorcc32"
    echo "  ia64-unknown-linux-gnu-gcc64"
    echo "  mips-sgi-irix6.5-vendorcc32"
    echo "  powerpc-ibm-aix5.1.0.0-vendorcc32"
    exit;
fi

source version.sh

NAME="gsi_openssh_bundle-$VERSION-$1.tar.gz"
XML="gsi_openssh_bundle-bin.xml"

if [ ! -e output/$NAME ]; then
    if [ ! -e output/ ]; then
        mkdir -p output/
    fi

    if [ ! -e work/ ]; then
        WORK_SCRIPTCREATED="1"
        mkdir -p work/
        cp $XML work/
    fi

    if [ ! -e work/sources/ ]; then
        cp -a sources work/sources
    fi

    cd work/
    $GPT_LOCATION/sbin/gpt-bundle -output=$NAME -bv=$VERSION -xml=$XML
    mv $NAME ../output/
    cd ../

    if [ "x$WORK_SCRIPTCREATED" != "x" ]; then
        rm -rf work/
    fi
else
    echo "Please remove output/$NAME before running this script."
    exit;
fi

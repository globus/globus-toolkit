#
# Copyright (c) 1999,2000 WU-FTPD Development Group.
# All rights reserved.
# 
# Portions Copyright (c) 1980, 1985, 1988, 1989, 1990, 1991, 1993, 1994 
#    The Regents of the University of California.  
# Portions Copyright (c) 1993, 1994 Washington University in Saint Louis.  
# Portions Copyright (c) 1989 Massachusetts Institute of Technology.  
# Portions Copyright (c) 1998 Sendmail, Inc.
# Portions Copyright (c) 1983, 1995, 1996, 1997 Eric P. Allman.  
# Portions Copyright (c) 1996, 1998 Berkeley Software Design, Inc.  
# Portions Copyright (C) 1991, 1992, 1993, 1994, 1995 1996, 1997 
#    Free Software Foundation, Inc.  
# Portions Copyright (c) 1997 Stan Barber.  
# Portions Copyright (c) 1997 Kent Landfield.
# 
# Use and distribution of this software and its source code are governed by 
# the terms and conditions of the WU-FTPD Software License ("LICENSE").
# 
# If you did not receive a copy of the license, it may be obtained online at
# http://www.wu-ftpd.org/license.html.
# 
# $Id$
#

# For gmake virtual path support
srcdir = @srcdir@
VPATH = @srcdir@

#
# Generic Makefile for autoconf'ed build
#

CC=@GLOBUS_LIBTOOL@ --mode=compile @CC@
COMPILE = @GLOBUS_LIBTOOL@ --mode=compile @CC@
LINK = @GLOBUS_LIBTOOL@ --mode=link @CC@

GLOBUS_DATA_CFLAGS=@GLOBUS_DATA_CFLAGS@
GLOBUS_DATA_LDFLAGS=@GLOBUS_DATA_LDFLAGS@
GLOBUS_DATA_LIBS=@GLOBUS_DATA_LIBS@

#WNOERROR=-Werror
#WARNINGS=$(WNOERROR) -Wall -Wpointer-arith -Wcast-align -Wstrict-prototypes -Wmissing-prototypes 

CFLAGS=$(WARNINGS)                          \
       @CFLAGS@                             \
       @GSSAPI_CFLAGS@                      \
       @AFS_CFLAGS@                         \
       $(GLOBUS_DATA_CFLAGS)
LDFLAGS=@STATIC_FLAGS@		            \
	@LDFLAGS@                           \
        @GPT_LDFLAGS@			    \
        @GSSAPI_LDFLAGS@                    \
        @AFS_LDFLAGS@                       

YACC=@YACC@
LIBS=@LIBS@                                 \
     @GSSAPI_LDFLAGS@                       \
     @GSSAPI_LIBS@                          \
     @AFS_LDFLAGS@                          \
     @AFS_LIBS@                             \
     $(GLOBUS_DATA_LDFLAGS)                 \
     $(GLOBUS_DATA_LIBS)

UTIL_SRC  = COPYRIGHT.c vers.c
UTIL_OBJS = COPYRIGHT.o vers.o

GSSAPI_SRC  = @GSSAPI_SRC@
GSSAPI_OBJS = $(GSSAPI_SRC:.c=.o)

AFS_SRC = @AFS_SRC@
AFS_OBJS = $(AFS_SRC:.c=.o)

SRCS   = ${UTIL_OBJS} ftpmlsd.c mlsx.c mlsx_facts.c ftpd.c ftpcmd.c glob.c logwtmp.c popen.c access.c \
	extensions.c realpath.c acl.c private.c authenticate.c conversions.c \
	rdservers.c paths.c hostacc.c sigfix.c auth.c routevector.c \
	restrict.c domain.c wu_fnmatch.c timeout.c getpwnam.c globus_hack.c \
	cksmcmd.c $(GSSAPI_SRC) $(AFS_SRC)

OBJS   = ${UTIL_OBJS} mlsx.o mlsx_facts.o ftpd.o ftpcmd.o glob.o logwtmp.o popen.o access.o \
	extensions.o realpath.o acl.o private.o authenticate.o conversions.o \
	rdservers.o paths.o hostacc.o sigfix.o auth.o routevector.o \
	restrict.o domain.o wu_fnmatch.o timeout.o getpwnam.o globus_hack.o \
	cksmcmd.o $(GSSAPI_OBJS) $(AFS_OBJS)

.c.o:
	$(COMPILE) $(CFLAGS) -I. -I.. -I$(srcdir) -I$(srcdir)/.. -I../support -c -o $@ $<

all: ftpd ftpcount ftpshut ftprestart ckconfig ftpmlsd

${OBJS}: config.h ../config.h pathnames.h

ftpcmd.c: config.h ../config.h pathnames.h $(srcdir)/ftpcmd.y
	$(YACC) $(srcdir)/ftpcmd.y
	mv -f y.tab.c ftpcmd.c

ftpcount: ${UTIL_OBJS} ftpcount.o 
	$(LINK) $(CFLAGS) -o $@ ${UTIL_OBJS} ftpcount.o -L../support $(LDFLAGS) $(LIBS)

ftpshut: ${UTIL_OBJS} ftpshut.o rdservers.o 
	$(LINK) $(CFLAGS) -o $@ ${UTIL_OBJS} ftpshut.o rdservers.o -L../support $(LDFLAGS) $(LIBS)

ftpmlsd: ${UTIL_OBJS} ftpmlsd.o mlsx_facts.o realpath.o sigfix.o
	$(LINK) $(CFLAGS) -o $@ ${UTIL_OBJS} mlsx_facts.o ftpmlsd.o realpath.o sigfix.o -L../support $(LDFLAGS) $(LIBS)

ftprestart: ${UTIL_OBJS} ftprestart.o rdservers.o 
	$(LINK) $(CFLAGS) -o $@ ${UTIL_OBJS} ftprestart.o rdservers.o -L../support $(LDFLAGS) $(LIBS)

ckconfig: ${UTIL_OBJS} ckconfig.o rdservers.o
	$(LINK) $(CFLAGS) -o $@ ${UTIL_OBJS} ckconfig.o rdservers.o -L../support $(LDFLAGS)  $(LIBS)

ftpd: ${OBJS}
	$(LINK) $(CFLAGS) -o $@ ${OBJS} -L../support $(LDFLAGS) $(LIBS)

vers.c: version.h

clean:
	rm -f ${OBJS} ftpd ftpcmd.c ftpshut ftpshut.o ftpmlsd ftpmlsd.o
	rm -f ftprestart ftprestart.o ftpcount ftpcount.o
	rm -f core index index.o ckconfig ckconfig.o *.lo
	rm -rf .libs

distclean: clean
	rm -f config.h Makefile edit pathnames.h version.h

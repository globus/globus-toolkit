AC_REVISION($Revision$)
AC_INIT(globus-lsf.conf.in)

# checking for the GLOBUS_LOCATION

if test "x$GLOBUS_LOCATION" = "x"; then
    echo "ERROR Please specify GLOBUS_LOCATION" >&2
    exit 1
fi

AC_ARG_WITH(log-path, [--with-log-path=PATH], LSF_LOGDIR=$withval,
        LSF_LOGDIR='')

if test "$LSF_LOGDIR" = "" || test "$LSF_LOGDIR" = "yes" || test "$LSF_LOGDIR" = "no"; then
    if test ! -n "${LSF_ENVDIR}"; then
        AC_MSG_WARN([Using default of /etc for LSF_ENVDIR])
        LSF_ENVDIR=/etc
    fi

    LSF_CONF_FILE="${LSF_ENVDIR}/lsf.conf"

    if test ! -r "${LSF_CONF_FILE}"; then
        AC_MSG_ERROR([LSF configuration ${LSF_CONF_FILE} not found.])
    fi

    . $LSF_CONF_FILE

    if ! test -d "$LSB_SHAREDIR"; then
        AC_MSG_ERROR(
            [LSF configuration ${LSF_CONF_FILE} does not define LSB_SHAREDIR.])
    fi

    cluster_name=`lsid | grep '^My cluster name' | sed -e 's/My cluster name is //'`

    LSF_LOGDIR=$LSB_SHAREDIR/$cluster_name/logdir
fi

AC_SUBST(LSF_LOGDIR)

AC_OUTPUT(
    globus-lsf.conf:globus-lsf.conf.in
)
